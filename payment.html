<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Secure Payment | Gear 4 Rent</title>

<style>
body{
    font-family: Arial;
    background: linear-gradient(135deg,#1e3a8a,#0f172a);
    margin:0;
}

.container{
    max-width:500px;
    margin:60px auto;
    background:white;
    padding:30px;
    border-radius:15px;
}

input, select{
    width:100%;
    padding:12px;
    margin-bottom:15px;
    border-radius:8px;
    border:1px solid #ccc;
}

button{
    width:100%;
    padding:14px;
    background:#1e3a8a;
    color:white;
    border:none;
    cursor:pointer;
}

.success-popup{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.6);
    display:none;
    justify-content:center;
    align-items:center;
}

.popup-box{
    background:white;
    padding:30px;
    border-radius:12px;
    text-align:center;
}
</style>
</head>

<body>

<div class="container">
<h2 id="productTitle"></h2>
<p id="productSpecs"></p>
<h3>Total: â‚¹<span id="productPrice"></span></h3>

<form id="paymentForm">
<input type="text" id="fullName" placeholder="Full Name" required>
<input type="email" id="email" placeholder="Email" required>

<select id="paymentMethod" required>
<option value="">Select Payment Method</option>
<option>Credit Card</option>
<option>Debit Card</option>
<option>UPI</option>
<option>cash on delivery</option>
</select>

<input type="text" id="cardNumber" placeholder="Card / UPI Number" required>
<input type="text" id="expiry" placeholder="Expiry / UPI ID" required>
<input type="text" id="address" placeholder="enter delivery address" required>
<button type="submit">Confirm Order & Pay</button>
</form>
</div>

<div class="success-popup" id="successPopup">
<div class="popup-box">
<h2>âœ… Order Confirmed!</h2>
<p id="orderDetails"></p>
<button onclick="goHome()">Back to Services</button>
</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCWZsMhVEB1HbbkTC8igAPlsoE8EzqBtzU",
    authDomain: "gear-4-rent.firebaseapp.com",
    projectId: "gear-4-rent",
    storageBucket: "gear-4-rent.firebasestorage.app",
    messagingSenderId: "1058165643099",
    appId: "1:1058165643099:web:8795bd0b0edf890caeec7e",
    measurementId: "G-NM319RRN80"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
window.onload = function(){
    const product = JSON.parse(localStorage.getItem("selectedProduct"));
    if(product){
        document.getElementById("productTitle").innerText = product.name;
        document.getElementById("productSpecs").innerText = product.specs;
        document.getElementById("productPrice").innerText = product.price;
    }
};

document.getElementById("paymentForm").addEventListener("submit", function(e){
    e.preventDefault();

    const product = JSON.parse(localStorage.getItem("selectedProduct"));
    const fullName = document.getElementById("fullName").value;
    const email = document.getElementById("email").value;
    const paymentMethod = document.getElementById("paymentMethod").value;
    const cardNumber = document.getElementById("cardNumber").value;
    const expiry = document.getElementById("expiry").value;

    const orderData = {
        productName: product.name,
        productSpecs: product.specs,
        productPrice: product.price,
        fullName,
        email,
        paymentMethod,
        cardNumber,
        expiry,
        orderID: "G4R" + Math.floor(Math.random()*100000),
        orderDate: new Date().toLocaleString()
    };

    // âœ… Store order in Firebase
    db.collection("orders").add(orderData)
    .then(()=>{
        document.getElementById("orderDetails").innerHTML =
            `Your order for <b>${product.name}</b> has been placed successfully!<br>
            ðŸ“¦ Your order will be delivered in <b>2 days</b>.<br>Thanks for ordering!`;
        document.getElementById("successPopup").style.display="flex";

        localStorage.removeItem("selectedProduct");
    })
    .catch(err=>{
        alert("Error storing order: "+err);
    });
});

function goHome(){
    window.location.href="services.html";
}
</script>

</body>
</html>